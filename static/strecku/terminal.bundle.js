!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/static/strecku/",t(t.s=5)}([function(e,t,n){"use strict";angular.module("strecku.datefilter",[]).filter("dynamicDate",["$filter",function(e){return function(t,n,r){return t=new Date(t),Date.now()-t<6048e5?e("date")(t,"EEE",r):t.getFullYear()===(new Date).getFullYear()?e("date")(t,"d/M",r):e("date")(t,"d/M/yy",r)}}]),angular.module("strecku.volumefilter",[]).filter("volume",["$filter",function(e){return function(t){return t=parseInt(t)/10,t>=100?e("number")(t/100,0)+"l":e("number")(t,0)+"cl"}}])},,function(e,t,n){"use strict";angular.module("strecku.codescanner",[]).directive("codeScanner",function(){return{restrict:"A",link:function(e,t,n){var r="";t.on("keypress",function(t){if(r&&13==t.keyCode||35==t.keyCode)return e.$eval(n.codeScanner,{$code:r}),r="";var o=String.fromCharCode(t.which);/\d/.test(o)&&(r+=o)})}}})},,,function(e,t,n){"use strict";n(2),n(0),angular.module("strecku.terminal",["strecku.codescanner","strecku.datefilter","strecku.volumefilter","ngMaterial","ngMessages","ngRoute","ngCookies","ngAnimate","btford.socket-io"]).config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("blue-grey").accentPalette("grey"),e.theme("dark").backgroundPalette("blue-grey").dark()}]).factory("StoreLog",["socketFactory",function(e){return e({ioSocket:io({path:"/api/streaming/v1"})})}]).controller("MainCtrl",["$scope","$q","$http","$mdDialog","$timeout","StoreLog",function(e,t,n,r,o,i){function u(t){e.codeConfirm?r.cancel():s(t)?e.item=null:e.item&&e.item.user&&t.product?(d(e.item.user._id,t.product._id),e.item.user=null):e.item&&e.item.product&&t.user?(d(t.user._id,e.item.product._id),e.item.user=null):(a(),"user"===t.type?n.get("/api/v1/purchases?user="+t.user._id+"&limit=5").then(function(n){t.purchases=n.data.purchases,e.item=t}):e.item=t)}function c(t){e.codeConfirm?e.codeConfirm==t?r.hide(t):r.cancel():e.item&&e.item.user?l(e.item.user,t).then(function(e){console.log("Add user code",e),a()},a):e.item&&e.item.product?l(e.item.product,t).then(function(e){console.log("Add product code",e),a()},a):e.item&&e.item.pendingCode===t?e.item=null:n.get("/api/v1/users").then(function(n){e.item={pendingCode:t,users:n.data.users}})}function s(t){return e.item&&(e.item.user&&t.user&&e.item.user._id==t.user._id||e.item.product&&t.product&&e.item.product._id==t.product._id)}function a(){o.cancel(e.timeout),(e.timeout=o(5e3)).then(function(){e.item=null})}function d(e,t){return n.post("/api/v1/purchases",{user:e,product:t})}function l(t,n){return o.cancel(e.timeout),e.codeConfirm=n,r.show({controller:function(){},templateUrl:"views/add_code.html",clickOutsideToClose:!0,locals:{code:n,target:t},bindToController:!0,controllerAs:"ctrl"}).then(function(){return n})}n.get("/api/v1/stores/this").then(function(t){e.store=t.data}),n.get("/api/v1/purchases?limit=25").then(function(t){e.log=t.data.purchases,i.on("purchase",function(t){return e.log.push(t)})}),e.onCode=function(e){n.get("/api/v1/codes/"+e).then(function(e){return e.data}).then(u,c.bind(this,e))},e.assignCode=function(t,r){n.post("/api/v1/users/"+r._id+"/codes",{code:t}),e.item=null}}])}]);