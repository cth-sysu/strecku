!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/static/strecku/",e(e.s=2)}([function(t,e,n){"use strict";angular.module("strecku.datefilter",[]).filter("dynamicDate",["$filter",function(t){return function(e,n,r){return e=new Date(e),Date.now()-e<6048e5?t("date")(e,"EEE",r):e.getFullYear()===(new Date).getFullYear()?t("date")(e,"d/M",r):t("date")(e,"d/M/yy",r)}}]),angular.module("strecku.volumefilter",[]).filter("volume",["$filter",function(t){return function(e){return e=parseInt(e)/10,e>=100?t("number")(e/100,0)+"l":t("number")(e,0)+"cl"}}])},function(t,e,n){"use strict";angular.module("strecku.purchases",[]).service("PurchasesList",["$http","$timeout",function(t,e){var n=function(t){this.items={},this.length=-1,this.url=t?"/api/v1/stores/"+t+"/purchases":"/api/v1/purchases",this.reload()};return n.prototype._fetchPage=function(e){var n=this;this.items[e]=null,t.get(this.url+"?limit=50&offset="+50*e+(this.user?"&user="+this.user._id:"")).then(function(t){return n.items[e]=t.data.purchases})},n.prototype.initialized=!1,n.prototype.reload=function(){var e=this;this.items=[],t.get(this.url+"/count"+(this.user?"?user="+this.user._id:"")).then(function(t){return e.length=t.data.count})},n.prototype.filterUser=function(t){this.user=t,this.reload()},n.prototype.getItemAtIndex=function(t){var e=Math.floor(t/50),n=this.items[e];if(n)return n[t%50];null!==n&&this._fetchPage(e)},n.prototype.getLength=function(){return this.length},n}])},function(t,e,n){"use strict";n(0),n(1),angular.module("strecku.admin",["strecku.datefilter","strecku.volumefilter","strecku.purchases","ngMaterial","ngMessages","ngRoute","ngCookies","ngAnimate","ngSanitize"]).config(["$routeProvider","$locationProvider",function(t,e){t.when("/admin/:store_id",{redirectTo:function(t,e){return e+"/general?menu=true"}}).when("/admin/:store_id/general",{templateUrl:"admin/views/general.html",controller:"GeneralCtrl"}).when("/admin/:store_id/accesses",{templateUrl:"admin/views/accesses.html",controller:"AccessesCtrl"}).when("/admin/:store_id/accesses2",{templateUrl:"admin/views/accesses-old.html",controller:"AccessesCtrl"}).when("/admin/:store_id/products",{templateUrl:"admin/views/products.html",controller:"ProductsCtrl"}).when("/admin/:store_id/products2",{templateUrl:"admin/views/products-old.html",controller:"ProductsCtrl"}).when("/admin/:store_id/purchases",{templateUrl:"admin/views/purchases.html",controller:"PurchasesCtrl"}).when("/admin/:store_id/webhooks",{templateUrl:"admin/views/webhooks.html",controller:"WebhooksCtrl"}).when("/admin/:store_id/invite",{templateUrl:"admin/views/invite.html",controller:"InviteCtrl"}).when("/admin/:store_id/api",{templateUrl:"admin/views/api.html",controller:"ApiCtrl"}),e.html5Mode(!0)}]).config(["$mdThemingProvider",function(t){t.theme("default").primaryPalette("blue-grey").accentPalette("grey")}]).run(["$window","$mdMedia","$rootScope","$location","$http",function(t,e,n,r,o){n.back=function(r){if(r||e("gt-xs"))return t.location.href="/";n.menu.show=!0},n.menu={show:!1},n.$on("$routeChangeSuccess",function(){return n.menu.show=!!r.search().menu});var i=r.path().match(/^\/admin\/([^\/]*)/)[1];o.get("/api/v1/stores/"+i).then(function(t){return n.store=t.data})}]).service("AddAction",function(){this.active=!1,this.config=function(t,e){this.active=!!t,this.label="Add "+t,this.action=e}}).directive("productImage",function(){return function(t,e,n){var r=function(t,n){return e.attr("src","/api/v1/products/"+t+"/images/0?"+n)};t.$watch(n.productImage,function(e){var n=0;r(e,n),t.$on(e+"/images",function(){return r(e,++n)})})}}).controller("AddActionCtrl",["$scope","AddAction",function(t,e){t.add=e}]).filter("admin",function(){return function(t){return t.filter(function(t){return t.admin})}}).filter("valid",function(){return function(t,e,n){return t.filter(function(t){return new Date(t.since)<=new Date(e)==(void 0==n||n)})}}).controller("MenuCtrl",["$scope","$route",function(t,e){t.active=function(t){return e.current&&e.current.controller==t+"Ctrl"}}]).controller("GeneralCtrl",["$routeParams","$scope","$http","AddAction","$window","$mdColorPalette",function(t,e,n,r,o,i){r.config(!1),e.colors=Object.keys(i),e.save=function(r,o){return n.put("/api/v1/stores/"+t.store_id,{name:r,color:o}).then(function(t){return e.store.name=r})},n.get("/api/v1/stores/"+t.store_id+"/users").then(function(t){e.users=t.data.users,e.total=e.users.reduce(function(t,e){return t+(e.debt||0)},0)}),e.debt_filter=function(t){return t.debt},e.date=Date.now(),e.print=function(){return o.print()},e.storeBackupLink="/api/v1/stores/"+t.store_id+"/backup?type=store&pretty=true",e.purchasesBackupLink="/api/v1/stores/"+t.store_id+"/purchases/backup?type=purchases&pretty=true"}]).controller("AccessesCtrl",["$routeParams","$scope","$http","AddAction","$mdToast","$mdDialog","$window",function(t,e,n,r,o,i,s){function c(t,e){n.put(u+"/"+t._id,{level:e}).then(function(n){return t.level=e})}r.config("access",function(n){return i.show({controller:"AccessesAddCtrl",templateUrl:"admin/views/accesses/add_access.html",targetEvent:n,clickOutsideToClose:!0,locals:t}).then(function(t){return e.accesses.push(t)})});var u="/api/v1/stores/"+t.store_id+"/accesses";n.get(u).then(function(t){return e.accesses=t.data.accesses}),e.toggleDiscount=function(t){return c(t,t.level?0:1)},e.toggleAdmin=function(t){n.put(u+"/"+t._id,{admin:!t.admin}).then(function(e){return t.admin=!t.admin})},e.remove=function(t){n.delete(u+"/"+t._id).then(function(n){return e.accesses.splice(e.accesses.indexOf(t),1)})}}]).controller("AccessesAddCtrl",["$scope","$http","$q","$mdDialog","store_id",function(t,e,n,r,o){t.$on("$routeChangeStart",t.cancel=r.cancel),t.queryUsers=function(t){return e.get("/api/v1/users?limit=4&search="+t).then(function(t){return t.data.users})},t.add=function(n){return e.post("/api/v1/stores/"+o+"/accesses",{user:n._id,level:1}).then(function(t){return r.hide(t.data)}).catch(function(e){return t.accessForm.user.$setValidity("duplicate",!1)})}}]).controller("ProductsCtrl",["$routeParams","$scope","$http","AddAction","$mdDialog",function(t,e,n,r,o){r.config("product",function(n){return o.show({controller:"ProductsAddCtrl",templateUrl:"admin/views/products/add_product.html",targetEvent:n,clickOutsideToClose:!0,locals:t}).then(function(t){return e.products.push(t)})});var i="/api/v1/stores/"+t.store_id+"/products";n.get(i).then(function(t){return e.products=t.data.products}),e.setAvailability=function(t,e){return n.put(i+"/"+t._id,{available:e}).then(function(n){return t.available=e})},e.edit=function(e,n){return o.show({controller:"ProductsEditCtrl",templateUrl:"admin/views/products/edit_product.html",targetEvent:n,clickOutsideToClose:!0,locals:{product:e,store_id:t.store_id}}).then(function(t){return e.pricelevels=t})},e.remove=function(t){return n.delete(i+"/"+t._id).then(function(n){return e.products.splice(e.products.indexOf(t),1)})}}]).controller("ProductsAddCtrl",["$scope","$http","$mdConstant","$mdDialog","store_id","$filter","$timeout",function(t,e,n,r,o,i,s){t.$on("$routeChangeStart",t.cancel=r.cancel),t.queryProducts=function(t){return e.get("/api/v1/products?limit=50&search="+t).then(function(t){return t.data.products})},t.productText=function(t){return t.name+(t.metadata.systembolaget?" "+i("volume")(t.metadata.systembolaget.Volymiml)+" "+t.metadata.systembolaget.Forpackning+" ("+i("currency")(t.metadata.systembolaget.Prisinklmoms+(t.metadata.systembolaget.Pant||0),"kr")+")":"")},t.addExisting=function(n,i,s){var c=[i*(1-(s||0)/100),i];e.post("/api/v1/stores/"+o+"/products",{product:n,pricelevels:c}).then(function(t){return r.hide(t.data)}).catch(function(e){return t.productForm.product.$setValidity("duplicate",!1)})},t.addNew=function(n,i,s){var c=[i*(1-(s||0)/100),i];e.post("/api/v1/stores/"+o+"/products",{name:n,pricelevels:c}).then(function(t){return r.hide(t.data)}).catch(function(e){return t.productForm.product.$setValidity("duplicate",!1)})}}]).controller("ProductsEditCtrl",["$scope","$http","$mdConstant","$mdDialog","store_id","product",function(t,e,n,r,o,i){t.$on("$routeChangeStart",t.cancel=r.cancel),t.product=i,t.price=1==i.pricelevels.length?i.pricelevels[0]:i.pricelevels[1],t.discount=i.pricelevels.length>1?Math.round(100*(1-i.pricelevels[0]/i.pricelevels[1])):void 0,t.save=function(t,n){var s=[t*(1-(n||0)/100),t];e.put("/api/v1/stores/"+o+"/products/"+i._id,{pricelevels:s}).then(function(t){return r.hide(s)})}}]).controller("PurchasesCtrl",["$routeParams","$scope","$http","AddAction","PurchasesList","$mdDialog",function(t,e,n,r,o,i){r.config("purchase",function(n){return i.show({controller:"PurchasesAddCtrl",templateUrl:"admin/views/purchases/add_purchase.html",targetEvent:n,clickOutsideToClose:!0,locals:t}).then(function(){return e.items.reload()})}),e.items=new o(t.store_id),e.delete=function(r){return n.delete("/api/v1/stores/"+t.store_id+"/purchases/"+r._id).then(function(){return e.items.reload()})},e.queryUsers=function(t){return n.get("/api/v1/users?search="+t).then(function(t){return t.data.users})}}]).controller("PurchasesAddCtrl",["$scope","$http","$mdDialog","store_id",function(t,e,n,r){function o(e,n){n&&e&&void 0!==e.access&&(t.purchase.price=Math.round(n.pricelevels[Math.min(n.pricelevels.length-1,e.access.level)]))}t.$on("$routeChangeStart",t.cancel=n.cancel),t.purchase={},t.time={date:new Date,time:new Date(0)},t.queryUsers=function(t){return e.get("/api/v1/stores/"+r+"/users?search="+t).then(function(t){return t.data.users})},t.queryProducts=function(t){return e.get("/api/v1/stores/"+r+"/products?search="+t).then(function(t){return t.data.products})},t.userChanged=function(e){return o(e,t.product)},t.productChanged=function(e){return o(t.user,e)},t.add=function(t,o,i,s){Object.assign(t,{user:o,product:i}),s&&(t.time=new Date(s.date),t.time.setHours(s.time.getHours(),s.time.getMinutes())),e.post("/api/v1/stores/"+r+"/purchases",t).then(function(t){return n.hide(t.data)})}}]).controller("WebhooksCtrl",["$routeParams","$scope","$http","AddAction","$mdDialog",function(t,e,n,r,o){r.config("webhook",function(n){return o.show({controller:"WebhooksAddCtrl",templateUrl:"admin/views/webhooks/add_webhook.html",targetEvent:n,clickOutsideToClose:!0,locals:t}).then(function(t){return e.webhooks.push(t)})}),n.get("/api/v1/stores/"+t.store_id+"/webhooks").then(function(t){return e.webhooks=t.data.webhooks}),e.remove=function(r){return n.delete("/api/v1/stores/"+t.store_id+"/webhooks/"+r._id).then(function(t){return e.webhooks.splice(e.webhooks.indexOf(r),1)})}}]).controller("WebhooksAddCtrl",["$scope","$http","$mdDialog","store_id",function(t,e,n,r){t.$on("$routeChangeStart",t.cancel=n.cancel),t.add=function(t,o,i,s){var c={name:t,action:o,url:i,template:s};e.post("/api/v1/stores/"+r+"/webhooks",c).then(function(t){return n.hide(t.data)})},e.get("/api/v1/stores/"+r+"/purchases?limit=1").then(function(e){t.example=e.data.purchases[0]})}]).controller("InviteCtrl",["$routeParams","$scope","$http","$mdToast","$location",function(t,e,n,r,o){e.sendInvite=function(e){return n.post("/api/v1/tokens",{email:e}).then(function(){r.show(r.simple().textContent("Invite send").action("add access").highlightAction(!0).highlightClass("md-primary")).then(function(){return o.path("/admin/"+t.store_id+"/accesses")})})}}]).controller("ApiCtrl",["$routeParams","$scope","$http","$sanitize",function(t,e,n,r,o){n.get("/api/v1/stores/"+t.store_id+"/token").then(function(t){return e.token=t.data.token}),e.copy=function(t){document.getElementById(t).select(),document.execCommand("copy")},n.get("/api/store.md").then(function(t){return n.post("https://api.github.com/markdown",{text:t.data})}).then(function(t){return e.docs=r(t.data)})}])}]);